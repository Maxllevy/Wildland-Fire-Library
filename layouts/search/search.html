{{- define "main" }}
<header class="page-header">
    <h1>{{- .Title }}</h1>
    <div class="post-meta">
        {{- if .Description }}
        <div class="post-description">{{ .Description }}</div>
        {{- end }}
    </div>
</header>
<div id="searchbox">
    <input id="searchInput" autofocus placeholder="{{ .Title }}" aria-label="search" type="search" />
    <div id="searchResults" aria-label="search results"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js"></script>
<script>
let index = {{ .Site.Pages | where .Site.Params.mainSections "posts" | jsonify }};
let fuseOptions = {
    shouldSort: true,
    location: 0,
    distance: 100,
    threshold: 0.4,
    minMatchCharLength: 2,
    keys: ["title", "content", "tags"]
};
let fuse = new Fuse(index, fuseOptions);

document.getElementById("searchInput").addEventListener("keyup", function() {
    let results = fuse.search(this.value);
    document.getElementById("searchResults").innerHTML = results
        .map(result => `
            <article class="post-entry">
                <header class="entry-header">
                    <h2><a href="${result.item.permalink}">${result.item.title}</a></h2>
                </header>
                ${result.item.description ? `<div class="entry-content">${result.item.description}</div>` : ''}
            </article>
        `)
        .join("");
});
</script>
{{- end }}