
{{- define "main" }}
<article class="post-single">
    <div style="background: #f0f0f0; padding: 10px; margin: 10px; font-family: monospace;">
        Debug Info:
        <br>Path Elements: {{ $pathElements := split .Title "/" }}{{ range $pathElements }}[{{ . }}] {{end}}
        <br>Main Category: {{ $mainCategory := index $pathElements 0 }}[{{ $mainCategory }}]
        <br>Sub Category: {{ if gt (len $pathElements) 1 }}{{ $subCategory := index $pathElements 1 }}[{{ $subCategory }}]{{end}}
        <br>Last Element: {{ $lastElement := index (split .Title "/") (sub (len (split .Title "/")) 1) }}[{{ $lastElement }}]
        <br>Number of Pages: {{ len .Pages }}
    </div>
    <header class="post-header">
        <!-- Breadcrumb Navigation -->
        <div class="breadcrumb" style="font-size: 0.9em; opacity: 0.7; margin-bottom: 1rem;">
            <a href="/" class="no-underline">Home</a>
            {{- $pathElements := split .Title "/" }}
            {{- $fullPath := "" }}
            {{- range $index, $element := $pathElements }}
                {{- $fullPath = printf "%s/%s" $fullPath $element }}
                <span class="mx-2">/</span>
                {{- $currentPath := printf "/tags%s" $fullPath }}
                {{- if ($.Site.GetPage $currentPath) }}
                    {{- $page := $.Site.GetPage $currentPath }}
                    {{- if gt (len $page.Pages) 0 }}
                        <a href="{{$currentPath}}" class="no-underline hover:opacity-70">
                            {{ $element | humanize | title }}
                        </a>
                    {{- else }}
                        <span>{{ $element | humanize | title }}</span>
                    {{- end }}
                {{- else }}
                    <span>{{ $element | humanize | title }}</span>
                {{- end }}
            {{- end }}
        </div>

        <!-- Main Title -->
        <h1 class="post-title">
            {{- $lastElement := index (split .Title "/") (sub (len (split .Title "/")) 1) }}
            {{ $lastElement | humanize | title }}
        </h1>

        <!-- Dynamic Section-Specific Summaries -->
        {{- if gt (len .Pages) 0 }}
        <div class="post-description">
            {{/* Get section path elements for categorization */}}
            {{- $pathElements := split .Title "/" }}
            {{- $mainCategory := index $pathElements 0 }}
            {{- $subCategory := "" }}
            {{- if gt (len $pathElements) 1 }}
                {{- $subCategory = index $pathElements 1 }}
            {{- end }}
            {{- $lastElement := index $pathElements (sub (len $pathElements) 1) }}

            {{/* Landowner Section Analyzers */}}
            {{- if eq $mainCategory "landowner" }}
                {{- if eq $subCategory "fire_preparedness" }}
                    {{- if eq $lastElement "escape_plans" }}
                        {{- $keywords := slice }}
                        {{- range .Pages }}
                            {{- $content := lower .Content }}
                            {{- if findRE "evacuation|route|emergency|exit" $content }}
                                {{- $keywords = $keywords | append "evacuation routes" }}
                            {{- end }}
                            {{- if findRE "communication|alert|notification" $content }}
                                {{- $keywords = $keywords | append "emergency communications" }}
                            {{- end }}
                            {{- if findRE "checklist|preparation|pack|kit" $content }}
                                {{- $keywords = $keywords | append "preparation checklists" }}
                            {{- end }}
                        {{- end }}
                        {{- $keywords = uniq $keywords }}
                        Resources for planning safe evacuations, including {{ delimit (first 3 $keywords) ", " }}.
                    {{- else if eq $lastElement "stay_informed" }}
                        Information sources for fire alerts, weather conditions, and emergency updates from local and federal agencies.
                    {{- else if eq $lastElement "current_fire_information" }}
                        Real-time data on active fires, smoke conditions, and fire weather forecasts.
                    {{- else if eq $lastElement "smoke_preparation" }}
                        Guidelines for protecting your health during smoke events and improving indoor air quality.
                    {{- end }}
                {{- else if eq $subCategory "property_management" }}
                    {{- if eq $lastElement "building_and_maintaining" }}
                        {{- $topics := slice }}
                        {{- range .Pages }}
                            {{- $content := lower .Content }}
                            {{- if findRE "defensible space|clearing|vegetation" $content }}
                                {{- $topics = $topics | append "creating defensible space" }}
                            {{- end }}
                            {{- if findRE "construction|material|roof|siding" $content }}
                                {{- $topics = $topics | append "fire-resistant construction" }}
                            {{- end }}
                            {{- if findRE "maintenance|upkeep|regular|seasonal" $content }}
                                {{- $topics = $topics | append "maintenance guides" }}
                            {{- end }}
                        {{- end }}
                        {{- $topics = uniq $topics }}
                        Property protection resources covering {{ delimit (first 3 $topics) ", " }}.
                    {{- end }}
                {{- else if eq $subCategory "grants" }}
                    {{- if eq $lastElement "available_grants" }}
                        {{- $grantTypes := slice }}
                        {{- range .Pages }}
                            {{- $content := lower .Content }}
                            {{- if findRE "federal|government|agency" $content }}
                                {{- $grantTypes = $grantTypes | append "federal grants" }}
                            {{- end }}
                            {{- if findRE "state|local|county" $content }}
                                {{- $grantTypes = $grantTypes | append "state/local funding" }}
                            {{- end }}
                            {{- if findRE "non.?profit|foundation|private" $content }}
                                {{- $grantTypes = $grantTypes | append "private funding" }}
                            {{- end }}
                        {{- end }}
                        {{- $grantTypes = uniq $grantTypes }}
                        Current funding opportunities including {{ delimit (first 3 $grantTypes) ", " }}.
                    {{- else if eq $lastElement "grant_writing_tips" }}
                        Expert guidance on crafting successful grant applications and managing funding proposals.
                    {{- end }}
                {{- end }}

            {{/* Student Section Analyzers */}}
            {{- else if eq $mainCategory "student" }}
                {{- if eq $subCategory "academic_assistance" }}
                    {{- if eq $lastElement "mentorships" }}
                        {{- $mentorshipTypes := slice }}
                        {{- range .Pages }}
                            {{- $content := lower .Content }}
                            {{- if findRE "research|lab|scientific" $content }}
                                {{- $mentorshipTypes = $mentorshipTypes | append "research mentoring" }}
                            {{- end }}
                            {{- if findRE "field|practical|hands.?on" $content }}
                                {{- $mentorshipTypes = $mentorshipTypes | append "field experience" }}
                            {{- end }}
                            {{- if findRE "career|professional|development" $content }}
                                {{- $mentorshipTypes = $mentorshipTypes | append "career development" }}
                            {{- end }}
                        {{- end }}
                        {{- $mentorshipTypes = uniq $mentorshipTypes }}
                        Mentorship opportunities focused on {{ delimit (first 3 $mentorshipTypes) ", " }}.
                    {{- else if eq $lastElement "financial_assistance" }}
                        {{- $fundingTypes := slice }}
                        {{- range .Pages }}
                            {{- $content := lower .Content }}
                            {{- if findRE "scholarship|tuition|academic" $content }}
                                {{- $fundingTypes = $fundingTypes | append "scholarships" }}
                            {{- end }}
                            {{- if findRE "fellowship|research|study" $content }}
                                {{- $fundingTypes = $fundingTypes | append "fellowships" }}
                            {{- end }}
                            {{- if findRE "grant|project|funding" $content }}
                                {{- $fundingTypes = $fundingTypes | append "research grants" }}
                            {{- end }}
                        {{- end }}
                        {{- $fundingTypes = uniq $fundingTypes }}
                        Financial support including {{ delimit (first 3 $fundingTypes) ", " }}.
                    {{- end }}
                {{- else if eq $subCategory "career_assistance" }}
                    {{- if eq $lastElement "jobs" }}
                        {{- $keywords := slice }}
                        {{- $organizations := slice }}
                        {{- range .Pages }}
                            {{- $content := lower .Content }}
                            {{- if findRE "fire\\s*(management|ecology|science)" $content }}
                                {{- $keywords = $keywords | append "fire management" }}
                            {{- end }}
                            {{- if findRE "research|scientist|fellowship" $content }}
                                {{- $keywords = $keywords | append "research" }}
                            {{- end }}
                            {{- if findRE "seasonal|temporary|summer" $content }}
                                {{- $keywords = $keywords | append "seasonal" }}
                            {{- end }}
                            {{- if findRE "federal|government|agency|usfs|blm|nps" $content }}
                                {{- $organizations = $organizations | append "federal agencies" }}
                            {{- end }}
                            {{- if findRE "university|college|academic" $content }}
                                {{- $organizations = $organizations | append "academic institutions" }}
                            {{- end }}
                        {{- end }}
                        {{- $keywords = uniq $keywords }}
                        {{- $organizations = uniq $organizations }}
                        Job opportunities including {{ delimit (first 3 $keywords) ", " }} positions with {{ delimit (first 2 $organizations) " and " }}.
                    {{- end }}
                {{- end }}

            {{/* Researcher Section Analyzers */}}
            {{- else if eq $mainCategory "researcher" }}
                {{- if eq $lastElement "climate" }}
                    {{- $topics := slice }}
                    {{- range .Pages }}
                        {{- $content := lower .Content }}
                        {{- if findRE "model|prediction|forecast" $content }}
                            {{- $topics = $topics | append "climate modeling" }}
                        {{- end }}
                        {{- if findRE "data|measurement|observation" $content }}
                            {{- $topics = $topics | append "climate data" }}
                        {{- end }}
                        {{- if findRE "impact|effect|influence" $content }}
                            {{- $topics = $topics | append "impact studies" }}
                        {{- end }}
                    {{- end }}
                    {{- $topics = uniq $topics }}
                    Climate research resources focusing on {{ delimit (first 3 $topics) ", " }}.
                {{- else if eq $lastElement "research_databases" }}
                    {{- $dbTypes := slice }}
                    {{- range .Pages }}
                        {{- $content := lower .Content }}
                        {{- if findRE "fire|burn|wildland" $content }}
                            {{- $dbTypes = $dbTypes | append "fire occurrence" }}
                        {{- end }}
                        {{- if findRE "climate|weather|atmospheric" $content }}
                            {{- $dbTypes = $dbTypes | append "climate data" }}
                        {{- end }}
                        {{- if findRE "vegetation|ecological|species" $content }}
                            {{- $dbTypes = $dbTypes | append "ecological" }}
                        {{- end }}
                    {{- end }}
                    {{- $dbTypes = uniq $dbTypes }}
                    Research databases covering {{ delimit (first 3 $dbTypes) ", " }} data.
                {{- else if eq $lastElement "current_strategies" }}
                    {{- $strategies := slice }}
                    {{- range .Pages }}
                        {{- $content := lower .Content }}
                        {{- if findRE "prevention|mitigation|reduction" $content }}
                            {{- $strategies = $strategies | append "fire prevention" }}
                        {{- end }}
                        {{- if findRE "management|prescribed|controlled" $content }}
                            {{- $strategies = $strategies | append "fire management" }}
                        {{- end }}
                        {{- if findRE "restoration|recovery|rehabilitation" $content }}
                            {{- $strategies = $strategies | append "ecosystem restoration" }}
                        {{- end }}
                    {{- end }}
                    {{- $strategies = uniq $strategies }}
                    Current research on {{ delimit (first 3 $strategies) ", " }} strategies.
                {{- end }}
            {{- end }}
        </div>
        {{- end }}
    </header>

    <!-- Content List -->
    <div class="post-content">
        {{- range .Pages.ByTitle }}
        <div class="post-entry">
            <header class="entry-header">
                <h2>{{ .Title }}</h2>
            </header>
            <div class="entry-content">
                {{ .Summary }}
            </div>
            <footer class="entry-footer">
                <a class="entry-link" href="{{ .Permalink }}"></a>
            </footer>
        </div>
        {{- end }}
    </div>
</article>
{{- end }}
